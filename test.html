<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpectraView SDK Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .status.recording {
            background: #10b981;
            color: white;
        }
        
        .status.stopped {
            background: #ef4444;
            color: white;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .card h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        button:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }
        
        button.danger {
            background: #ef4444;
        }
        
        button.danger:hover {
            background: #dc2626;
        }
        
        button.success {
            background: #10b981;
        }
        
        button.success:hover {
            background: #059669;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .log {
            background: #f3f4f6;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            background: white;
            border-radius: 3px;
        }
        
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .metric {
            text-align: center;
            padding: 10px;
            background: #f3f4f6;
            border-radius: 5px;
        }
        
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }
        
        .metric-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        .spectra-block {
            background: #fbbf24 !important;
            color: #000 !important;
        }
        
        .spectra-ignore {
            background: #ef4444 !important;
            color: white !important;
        }
        
        .spectra-mask {
            background: #000 !important;
            color: #000 !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé¨ SpectraView SDK Test Page</h1>
            <p>Testing session recording and event capture</p>
            <div id="status" class="status stopped">Not Recording</div>
        </div>

        <div class="grid">
            <!-- SDK Control -->
            <div class="card">
                <h2>üìπ SDK Control</h2>
                <button id="startBtn" class="success">Start Recording</button>
                <button id="stopBtn" class="danger">Stop Recording</button>
                <button id="flushBtn">Force Flush Events</button>
                <div class="metrics">
                    <div class="metric">
                        <div class="metric-value" id="eventCount">0</div>
                        <div class="metric-label">Events</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="clickCount">0</div>
                        <div class="metric-label">Clicks</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="errorCount">0</div>
                        <div class="metric-label">Errors</div>
                    </div>
                </div>
            </div>

            <!-- User Actions -->
            <div class="card">
                <h2>üëÜ User Actions</h2>
                <button onclick="alert('Hello World!')">Show Alert</button>
                <button onclick="console.log('Console log test')">Console Log</button>
                <button onclick="throwError()">Trigger Error</button>
                <button onclick="navigate('#test')">Navigate Hash</button>
                <button onclick="customEvent()">Custom Event</button>
                <button onclick="apiCall()">API Call</button>
            </div>

            <!-- Form Inputs -->
            <div class="card">
                <h2>üìù Form Inputs</h2>
                <input type="text" placeholder="Normal text input">
                <input type="email" placeholder="Email (should be masked)">
                <input type="password" placeholder="Password (should be masked)">
                <input type="tel" placeholder="Phone number">
                <select>
                    <option>Option 1</option>
                    <option>Option 2</option>
                    <option>Option 3</option>
                </select>
                <textarea placeholder="Text area for long text"></textarea>
            </div>

            <!-- Privacy Testing -->
            <div class="card">
                <h2>üîê Privacy Testing</h2>
                <p>Normal text: John Doe</p>
                <p>Email: test@example.com</p>
                <p>Phone: 555-123-4567</p>
                <p>Card: 4111 1111 1111 1111</p>
                <p>SSN: 123-45-6789</p>
                <div class="spectra-block" style="padding: 10px; margin: 10px 0;">
                    This should be blocked (yellow bg)
                </div>
                <div class="spectra-ignore" style="padding: 10px; margin: 10px 0;">
                    This should be ignored (red bg)
                </div>
                <div class="spectra-mask" style="padding: 10px; margin: 10px 0;">
                    This text should be masked (black bg)
                </div>
            </div>

            <!-- Event Log -->
            <div class="card">
                <h2>üìä Event Log</h2>
                <div id="eventLog" class="log">
                    <div class="log-entry">Waiting for events...</div>
                </div>
            </div>

            <!-- Network Requests -->
            <div class="card">
                <h2>üåê Network Testing</h2>
                <button onclick="fetchTest()">Fetch API Test</button>
                <button onclick="xhrTest()">XHR Test</button>
                <button onclick="fetch404()">404 Error</button>
                <button onclick="fetchError()">Network Error</button>
                <div id="networkLog" class="log">
                    <div class="log-entry">No requests yet...</div>
                </div>
            </div>
        </div>

        <!-- Dynamic Content -->
        <div class="card">
            <h2>üé≠ Dynamic Content</h2>
            <button onclick="addElement()">Add Element</button>
            <button onclick="removeElement()">Remove Element</button>
            <button onclick="changeStyles()">Change Styles</button>
            <button onclick="animateElement()">Animate</button>
            <div id="dynamicContainer" style="min-height: 100px; border: 2px dashed #ddd; padding: 10px; margin-top: 10px;">
                <p>Dynamic content will appear here</p>
            </div>
        </div>
    </div>

    <!-- SpectraView SDK -->
    <script>
        // Configuration
        window.SPECTRAVIEW_CONFIG = {
            apiKey: 'test-api-key-123',
            apiEndpoint: 'http://localhost:3001/api',
            appId: 'sdk-test-app',
            userId: 'test-user-001',
            debug: true,
            captureMode: 'full',
            batchSize: 10,
            flushInterval: 5000,
            maskAllInputs: true,
            sampling: {
                scroll: 150,
                mousemove: false,
                mouseInteraction: true
            }
        };
    </script>
    <script src="dist/spectraview.js"></script>
    
    <!-- Test Functions -->
    <script>
        let elementCounter = 0;
        const eventLog = document.getElementById('eventLog');
        const networkLog = document.getElementById('networkLog');
        let logCounter = 0;

        // Update metrics display
        setInterval(() => {
            if (window.SpectraView && window.SpectraView.performanceData) {
                document.getElementById('eventCount').textContent = 
                    window.SpectraView.performanceData.eventCount || 0;
                document.getElementById('clickCount').textContent = 
                    window.SpectraView.performanceData.clickCount || 0;
                document.getElementById('errorCount').textContent = 
                    window.SpectraView.performanceData.errorCount || 0;
            }
        }, 1000);

        // SDK Controls
        document.getElementById('startBtn').addEventListener('click', async () => {
            try {
                await window.SpectraView.init(window.SPECTRAVIEW_CONFIG);
                document.getElementById('status').className = 'status recording';
                document.getElementById('status').textContent = 'Recording...';
                addLogEntry('Recording started');
            } catch (error) {
                console.error('Failed to start recording:', error);
                addLogEntry('Error: ' + error.message, 'error');
            }
        });

        document.getElementById('stopBtn').addEventListener('click', () => {
            window.SpectraView.stop();
            document.getElementById('status').className = 'status stopped';
            document.getElementById('status').textContent = 'Stopped';
            addLogEntry('Recording stopped');
        });

        document.getElementById('flushBtn').addEventListener('click', () => {
            window.SpectraView.flush();
            addLogEntry('Events flushed');
        });

        // Test functions
        function throwError() {
            addLogEntry('Throwing error...');
            throw new Error('Test error from button click');
        }

        function navigate(hash) {
            window.location.hash = hash;
            addLogEntry('Navigated to ' + hash);
        }

        function customEvent() {
            window.SpectraView.capture('test_custom_event', {
                value: 'Test data',
                timestamp: Date.now()
            });
            addLogEntry('Custom event sent');
        }

        async function apiCall() {
            try {
                const response = await fetch('https://jsonplaceholder.typicode.com/posts/1');
                const data = await response.json();
                addLogEntry('API call successful');
                addNetworkEntry('GET /posts/1 - 200 OK');
            } catch (error) {
                addLogEntry('API call failed: ' + error.message, 'error');
            }
        }

        async function fetchTest() {
            try {
                const response = await fetch('https://jsonplaceholder.typicode.com/users');
                addNetworkEntry(`GET /users - ${response.status}`);
            } catch (error) {
                addNetworkEntry('Fetch failed: ' + error.message, 'error');
            }
        }

        function xhrTest() {
            const xhr = new XMLHttpRequest();
            xhr.open('GET', 'https://jsonplaceholder.typicode.com/todos/1');
            xhr.onload = () => {
                addNetworkEntry(`XHR GET /todos/1 - ${xhr.status}`);
            };
            xhr.onerror = () => {
                addNetworkEntry('XHR failed', 'error');
            };
            xhr.send();
        }

        async function fetch404() {
            try {
                const response = await fetch('https://jsonplaceholder.typicode.com/notfound');
                addNetworkEntry(`GET /notfound - ${response.status}`, response.ok ? 'success' : 'error');
            } catch (error) {
                addNetworkEntry('Fetch failed: ' + error.message, 'error');
            }
        }

        async function fetchError() {
            try {
                await fetch('http://invalid-domain-that-does-not-exist.com');
            } catch (error) {
                addNetworkEntry('Network error: ' + error.message, 'error');
            }
        }

        function addElement() {
            const elem = document.createElement('div');
            elem.className = 'dynamic-element';
            elem.style.cssText = 'background: #667eea; color: white; padding: 10px; margin: 5px; border-radius: 5px;';
            elem.textContent = `Dynamic Element ${++elementCounter}`;
            elem.onclick = () => {
                addLogEntry(`Clicked dynamic element ${elementCounter}`);
            };
            document.getElementById('dynamicContainer').appendChild(elem);
            addLogEntry('Added element ' + elementCounter);
        }

        function removeElement() {
            const container = document.getElementById('dynamicContainer');
            if (container.lastElementChild && container.lastElementChild.className === 'dynamic-element') {
                container.removeChild(container.lastElementChild);
                addLogEntry('Removed element');
            }
        }

        function changeStyles() {
            const container = document.getElementById('dynamicContainer');
            const colors = ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#4facfe'];
            container.style.background = colors[Math.floor(Math.random() * colors.length)];
            addLogEntry('Changed styles');
        }

        function animateElement() {
            const container = document.getElementById('dynamicContainer');
            container.style.transition = 'transform 0.5s ease';
            container.style.transform = `rotate(${Math.random() * 10 - 5}deg) scale(${0.95 + Math.random() * 0.1})`;
            setTimeout(() => {
                container.style.transform = '';
            }, 500);
            addLogEntry('Animated element');
        }

        function addLogEntry(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.style.color = type === 'error' ? '#ef4444' : '#333';
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            eventLog.insertBefore(entry, eventLog.firstChild);
            
            // Keep only last 10 entries
            while (eventLog.children.length > 10) {
                eventLog.removeChild(eventLog.lastChild);
            }
        }

        function addNetworkEntry(message, type = 'success') {
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.style.color = type === 'error' ? '#ef4444' : '#10b981';
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            networkLog.insertBefore(entry, networkLog.firstChild);
            
            // Keep only last 10 entries
            while (networkLog.children.length > 10) {
                networkLog.removeChild(networkLog.lastChild);
            }
        }

        // Auto-start for testing
        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('startBtn').click();
            }, 1000);
        });

        // Test promise rejection
        setTimeout(() => {
            Promise.reject('Test unhandled promise rejection');
        }, 5000);
    </script>
</body>
</html>